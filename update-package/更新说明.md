# 二手交易平台更新包 v2.1

## 更新内容

✅ **手机号验证更新**
- 新增支持澳洲手机号验证 (04-05开头10位)
- 保持支持中国手机号 (13-19开头11位)
- 更新API文档以反映双格式支持

✅ **API文档同步更新**
- 所有API文档已更新手机号格式说明
- 添加澳洲手机号示例
- 更新验证正则表达式

## 部署步骤

### 1. 停止当前服务
```bash
# 查找Java进程
ps aux | grep "second-hand"

# 停止服务 (替换PID为实际进程ID)
kill -9 <PID>

# 或者直接停止所有Java应用
sudo pkill -f "second-hand"
```

### 2. 备份当前版本
```bash
cd /opt/fliliy
cp second-hand-0.0.1-SNAPSHOT.jar second-hand-backup-$(date +%Y%m%d).jar
```

### 3. 替换新版本
```bash
# 将新的JAR文件复制到部署目录
cp /path/to/new/second-hand-0.0.1-SNAPSHOT.jar /opt/fliliy/
```

### 4. 启动新版本
```bash
cd /opt/fliliy
nohup java -jar \
    -Dspring.profiles.active=prod \
    -Xms512m -Xmx1024m \
    second-hand-0.0.1-SNAPSHOT.jar > app.log 2>&1 &

# 保存进程ID (可选)
echo $! > app.pid
```

### 5. 验证服务
```bash
# 等待启动
sleep 10

# 检查健康状态
curl http://localhost:8080/api/v1/health

# 检查日志
tail -f app.log
```

## 验证手机号功能

### 测试中国手机号
```bash
curl -X POST http://localhost:8080/api/v1/auth/sms/send \
  -H "Content-Type: application/json" \
  -d '{"mobile": "13800138000", "type": "register"}'
```

### 测试澳洲手机号
```bash
curl -X POST http://localhost:8080/api/v1/auth/sms/send \
  -H "Content-Type: application/json" \
  -d '{"mobile": "0412345678", "type": "register"}'
```

## 配置检查

确认配置文件中的以下设置正确：

```properties
# 服务器配置
server.port=8080
app.server.base-url=http://3.107.205.176:8080

# 数据库连接
spring.datasource.url=jdbc:mysql://localhost:3306/fliliy_db?useUnicode=true&characterEncoding=UTF-8&useSSL=false&serverTimezone=UTC

# 文件上传路径
app.upload.path=/opt/fliliy/uploads/
```

## 回滚步骤 (如果出现问题)

```bash
# 停止新版本
sudo pkill -f "second-hand"

# 恢复备份版本
cd /opt/fliliy
cp second-hand-backup-$(date +%Y%m%d).jar second-hand-0.0.1-SNAPSHOT.jar

# 重新启动
nohup java -jar second-hand-0.0.1-SNAPSHOT.jar > app.log 2>&1 &
```

## 版本信息

- **版本**: v2.1
- **构建时间**: 2025-09-20 13:06:26
- **主要更新**: 手机号验证支持中澳双格式
- **兼容性**: 完全向后兼容，无需数据库迁移

## 联系信息

如有部署问题，请检查：
1. 日志文件 `app.log`
2. 端口8080是否被占用
3. MySQL和Redis服务是否正常运行